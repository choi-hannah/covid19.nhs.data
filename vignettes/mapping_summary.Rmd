---
title: "Mapping local authorities to NHS Acute Trusts in England"
author: "Sophie Meakin"
output: html_document
vignette: >
  %\VignetteIndexEntry{Mapping local authorities to NHS Acute Trusts in England}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = FALSE, message = FALSE)

library(knitr)
```

# Summary

This package contains a many-to-many mapping between upper-tier local authority districts to NHS Acute Trusts in England, COVID-19 hospital admissions. This mapping can be used to match UTLA-level data, such as testing data, to hospital admissions and other related data that is typically provided at the Trust level.

The mapping contains the following variables:

* `trust_code`: the three-digit organisation code for NHS Trusts.
* `utla_code`: the nine-digit identifier for upper-tier local authorities in England.
* `p_trust`: the proportion of admissions to a given Trust were admitted from a given UTLA
* `p_utla`: the proportion of admissions from a given UTLA that were admitted to a given Trust.


# Usage

The mapping is provided as a built in package dataset and can be loaded directly using `covid19.england.hospitalisations::trust_utla_mapping` or as shown below. 


## Quick start

Load the library with: 

```{r package, echo = TRUE, eval = TRUE}
library(covid19.england.hospitalisations)
```

Load the raw mapping with `trust_utla_mapping`:

```{r load_raw_mapping, echo = TRUE, eval = TRUE}

trust_utla_mapping %>%
  head() %>%
  knitr::kable()

```

Add Trust names and upper-tier local authority names to the raw mapping with `get_names()`:

```{r add_names, echo = TRUE, eval = TRUE}

trust_utla_mapping %>% 
  get_names() %>%
  head() %>%
  knitr::kable()

```

Summarise the mapping for a given Trust (as defined by the Trust organisation code) with `summarise_mapping()`; this will return a table (under `summary_table`) and a visualisation of the Trust-UTLA mapping (under `summary_plot`):

```{r summarise for trust, echo = TRUE, eval = TRUE}

summary <- summarise_mapping(mapping = trust_utla_mapping, trust = "R0A")

summary$summary_table %>%
  knitr::kable()

summary$summary_plot

```

Summarise the mapping for a given UTLA (as defined by the UTLA organisation code) with `summarise_mapping()`; this will return a table (under `summary_table`):

```{r summarise for ltla, echo = TRUE, eval = TRUE}

summary <- summarise_mapping(mapping = trust_utla_mapping, utla = "E09000012")

summary$summary_table %>%
  knitr::kable()

```



# Methods

The raw (unpublished) mapping was provided by NHS England, This mapping provides the number of COVID-19 spells (discharges) between 01 January 2020 and 30 September 2020 by hospital-LTLA pairs, based on the Secondary Uses Service (SUS) healthcare data for England.

We have summarised the raw mapping to Trust-UTLA (rather than hospital-LTLA) pairs, and to maintain anonymity we excluded any Trust-UTLA pairs where the number of spells is less than 10. Finally, we report only the proportion of admissions by Trust (`p_trust`) or UTLA (`p_utla`).


